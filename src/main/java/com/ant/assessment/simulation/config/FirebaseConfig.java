package com.ant.assessment.simulation.config;

import com.google.auth.oauth2.GoogleCredentials;
import com.google.firebase.FirebaseApp;
import com.google.firebase.FirebaseOptions;
import org.springframework.context.annotation.Configuration;

import javax.annotation.PostConstruct;
import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.util.Base64;

@Configuration
public class FirebaseConfig {

    @PostConstruct
    public void init() throws IOException {
        String base64 = "ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiYW50LWNhci1yYWNpbmctc3lzdGVtIiwKICAicHJpdmF0ZV9rZXlfaWQiOiAiN2Y4MTQwZTY2YTU5ZDhjY2YxMWUwOTAzYjhkZWY2MDE3MGU0YWNlZCIsCiAgInByaXZhdGVfa2V5IjogIi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLVxuTUlJRXZBSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS1l3Z2dTaUFnRUFBb0lCQVFET21NdjVhVDh5c1p6b1xuU2dQNmVlQlZaMnNkQjluSDRzNVpLL0dzU0ZnOHk3RWE1UWdOT1ltYnJxeFk0QXRLcjdtNnNlbkJVSVdQNnlreFxuWExvemllVzJjNlp0bGMyRDR2eGlVNldFVW83OEFGM1M3V0Zucm94L3lzLzhYb3B6MmlXTThxcG02dTkxQm91VVxudmVXREl2Q1Q2bEs5UHIxL0I4Wit4KzN5TXZ5bmZhS2E4cVFPbDJoc2lvYTFHK2RrZzZESk5oMWpvNzU5V2piaVxuVFRnVXR6THRGdlB6enh4ZFJsTzZxTE9OeTk5QWlrK2JickNVbHZFRDNZSGJUY1dHWEx0QU5LVGw2VXRQMG5xWFxuaWNUeEJuU1lRRWpoMnY1bUJ4RDFLYmUzbjdMdFlBUkptakRZdG5aZTlmTVpGZVpwRlViUVNNU2FreFpJZ3JKelxuc2twL1A2SVpBZ01CQUFFQ2dnRUFaZmZYY1FZSHljTU5RVDlLNEdVb0dxNzlHS3FIekZiKzV0ZEFKSHJlaGo4NFxuN2gvTnpnMHdoSlQ5ZnE0eUZJNVArcndXTmpKQ2djcWRIYjU1THJmb2w1bFVNdkZGcXNzdEszRENtR0ZSTGtNV1xuQytYYTlod2FQM2JBR2YwbGs5Ry9SK1o3d1dsQ2YvMlhoZllHSWlmc0d1MkVJZUNtRWQwcUZPZ2o0cTlVc1d0M1xuZ2xEdmlORGtyckhNNDNHY3EyMWo3WmlkQnFKbFZ1bGdmeGNacisyQWozRjlVYURBTXhKZzgxdlF2d0lyYTIzc1xuNS9CbUJSRXBkOU5IL3Q4OS9tbUNCUi9FVEwweTZ0WFhIQmN4UmVLRHNEVk1xSDFMVjBDVUV6dXUvc0R2L1NBdFxuZW0vWkE5cC92Rms2Y1BMZkJlT2F5Wlh4cmUvdFFPd1IvWnVOeE9OTXV3S0JnUURtQitGVUpkZUdram9udjdpdlxuVUZLZXdsU2E0WEJ1L3duTkJEYXhDZWFVMHQ5Tjd5VzBGT20rRGlFcmRXU3RheFh5TEM2WEljaFRZS0F6UDVEa1xueUZ0TWYyR0FVMlJzOHhGMEZnNE9wMzEyd3hFc21KRmt4eDRrdzROY3ZZK0IxN01sRmhObE5hTXBrQ09hd2lHZFxuMkdUVXlxZ2krSWVpSU41WVdLaHNRK0QzMndLQmdRRGw2NmNoanB3elc0ZnBzTDBwQm9yeGVHTXpWUHFOcFYyVFxuWk9aRGpvZjU2NjVPT2xZRUJZOTBJNkF1RFQ2ZVhLTFN2OVhhcXlURVFuSVJ0ZVdLNnhUYzN5MkZWaVlTNUtzU1xuVW9pQXJkbkFvVEx6TW1kVzVCUFo1c3BUK2lPVGJtYTE5SG1FQU1qYWVxVTZNRkJyQko3ekRpWTdDbk1LNDAycVxuMUlHRWV1L2FHd0tCZ0E4bE42M05yQW9kT0owRFg0cVRkRTBscUdKbU0zdnJhTjdKeHp3UzFjNjRyNkUyL0xtRlxub3ZvemZmV1pqaDVvN1pIN1hMbndySHJvNHNOZERSSXpLdWUzZjFqdXBLOFR0Zk41dkVVMHUrc0UzdTJid2Y3clxucVUxc1hnck9KRk85T3Z0WEg4SExMVW9BUm9mYS9sR2hQTXBSNlk0YjVQcEV4YjcxWDJsNWNxZC9Bb0dBR3BiTlxuQmpGeTJQR2QzeVdrU29sS0tqQ3M4RFBFb2ZyY3ZuM3RyeVJkajBaMUt2RE9IN3J3NHhKM3BMdTlZUnovYTNYcFxuNmxiZWNwL29oeW5NK09yRXgrSTdabThYQ2hwTnVsbTNGWUtGYXlSNU91eTZUSzhscUk1ckdaa1U0aWpqVWVtS1xuMy93alBqanV3TEx6cWR5bjhSM1N5QU1tV0x6K3IySFI5SnN1Lzc4Q2dZQUQxTHF0MkdYd1VhdzBzNmRWNGx6alxuMzUyMXpSdnhqcmNINGVpZnhpOEZjU3NFMm5JdG5ibUtqaDk0SGdwMXVXcGhMTEZnYVF0d2lSY1p1cDlvSmh3bFxuUDdScG9uZU04VlhSMUs5UkRkN2RRNHZncGNzQjI4SSsydWZsYUF1RUF6bEpRdi8rOWNMUzdOU1VWYTlvR0lreVxuRi82elVoMG9sRXdhbXF6aGdvVkxMUT09XG4tLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tXG4iLAogICJjbGllbnRfZW1haWwiOiAiZmlyZWJhc2UtYWRtaW5zZGstZmJzdmNAYW50LWNhci1yYWNpbmctc3lzdGVtLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwOTc0MTQ2ODk3MzE2MTU3NTI5OSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvZmlyZWJhc2UtYWRtaW5zZGstZmJzdmMlNDBhbnQtY2FyLXJhY2luZy1zeXN0ZW0uaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJ1bml2ZXJzZV9kb21haW4iOiAiZ29vZ2xlYXBpcy5jb20iCn0K";

        if (base64 == null || base64.isBlank()) {
            throw new IllegalStateException("FIREBASE_CONFIG_BASE64 is not set");
        }

        byte[] decoded = Base64.getDecoder().decode(base64);

        FirebaseOptions options = FirebaseOptions.builder()
                .setCredentials(GoogleCredentials.fromStream(new ByteArrayInputStream(decoded)))
                .build();

        if (FirebaseApp.getApps().isEmpty()) {
            FirebaseApp.initializeApp(options);
        }
    }
}



